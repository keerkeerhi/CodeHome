**接口说明**

​	主要对相关使用接口做说明。

**目录**

[TOC]



---

## 用户登录

接口用途

> 用来在小程序登录时执行用户登录操作，获取用户openID和session_key。

接口地址

> /api/login/

访问方式

> HTTP   GET

参数字段

| 字段名称 | 字段说明                                                     |
| -------- | ------------------------------------------------------------ |
| code     | 登录凭证，通过微信wx.login获得，[微信文档](https://mp.weixin.qq.com/debug/wxadoc/dev/api/api-login.html#wxloginobject) |
| invite   | 邀请人的邀请码，非必选                                       |

返回字段

| 返回字段 | 说明                                                         |
| -------- | ------------------------------------------------------------ |
| code     | 返回码，详见返回码说明                                       |
| msg      | 详细信息                                                     |
| data     | 返回数据，数据格式字典，key说明：openid表示用户微信唯一标识，is_new表示用户是否是新创建的用户，True表示新用户，False表示老用户 |

返回码说明

| 返回码 | 说明             |
| ------ | ---------------- |
| 0      | 成功             |
| -1     | 参数不能为空     |
| -2     | 系统没有配置微信 |
| -3     | 获取openID失败   |
| -4     | 创建用户失败     |

---

# 更新用户信息

接口用途

> 用来更新用户基本信息，包括：昵称、头像、性别、国家、语言等。

接口地址

> /api/update/

访问方式

> HTTP  POST

参数字段

| 字段名称          | 说明                                              |
| ----------------- | ------------------------------------------------- |
| openid            | 用户微信唯一标识OpenID                            |
| nickname          | 昵称                                              |
| sex               | 性别，按照微信的说明，0标识未知，1标识男，2表示女 |
| avatar            | 头像地址                                          |
| country           | 国家                                              |
| province          | 省份                                              |
| city              | 城市                                              |
| language          | 语言                                              |
| **iv**            | **加密算法的初始向量**                            |
| **encryptedData** | **包括敏感数据在内的完整用户信息的加密数据**      |

返回字段

| 返回字段 | 说明   |
| -------- | ------ |
| code     | 返回码 |
| msg      | 信息   |

返回码说明

| 返回码 | 说明             |
| ------ | ---------------- |
| 0      | 成功             |
| -1     | 参数字段不能为空 |
| -2     | 错误的性别       |
| -3     | 错误的openID     |
| -4     | 更新失败         |

---

# 查询积分

接口用途

> 用来查询用户剩余积分，包括当前参与总人数和人均积分。

接口地址

> /api/query_balance/

访问方式

> HTTP  GET

传入参数

| 参数字段 | 说明         |
| -------- | ------------ |
| openid   | 微信唯一标识 |

返回字段

| 返回字段 | 说明                                                         |
| -------- | ------------------------------------------------------------ |
| code     | 返回码                                                       |
| msg      | 返回信息                                                     |
| data     | 返回数据。数据格式字段，key说明：balance表示用户剩余积分，p_num表示当前参与总人数，avg_balance表示人均积分数 |

返回码说明

| 返回码 | 说明         |
| ------ | ------------ |
| 0      | 成功         |
| -1     | 参数不能为空 |
| -2     | 错误的openid |

---

# 每日签到

接口用途

> 用来用户每日签到。

接口地址

> /api/sign/

访问方式

> HTTP  POST

参数字段

| 参数字段 | 说明         |
| -------- | ------------ |
| openid   | 微信唯一标识 |

返回字段

| 返回字段 | 说明     |
| -------- | -------- |
| code     | 返回码   |
| msg      | 返回信息 |

返回码说明

| 返回码 | 说明             |
| ------ | ---------------- |
| 0      | 成功             |
| -1     | 参数不能为空     |
| -2     | 每天只能签到一次 |
| -3     | 错误的openid     |
| -4     | 签到失败         |

---

# 获取邀请码

接口用途

> 用来获取用户的邀请码。

接口地址

> /api/query_share_code/

访问方式

> HTTP  GET

参数字段

| 参数字段 | 说明         |
| -------- | ------------ |
| openid   | 微信唯一标识 |

返回字段

| 返回字段 | 说明                                                         |
| -------- | ------------------------------------------------------------ |
| code     | 返回码                                                       |
| msg      | 返回信息                                                     |
| data     | 返回数据，数据格式字典，key说明：share_code标识邀请码，times表示当前积分倍数，**y_rank昨日邀请人数排行，n_rank今日邀请人数排行** |

返回码说明

| 返回码 | 说明         |
| ------ | ------------ |
| 0      | 成功         |
| -1     | 参数不能为空 |
| -2     | 错误的openid |

---

# 获取邀请记录

接口用途

> 用来获取用户的邀请记录。包括分页操作。

接口地址

> /api/query_share_record/

访问方式

> HTTP  GET

参数字段

| 参数字段 | 说明                 |
| -------- | -------------------- |
| openid   | 微信唯一标识         |
| index    | 页码，非必选，默认0  |
| num      | 数量，非必选，默认10 |

返回字段

| 返回字段 | 说明                                                         |
| -------- | ------------------------------------------------------------ |
| code     | 返回码                                                       |
| msg      | 返回信息                                                     |
| data     | 返回数据，数据格式列表，列表每个元素是字典，字典key说明：avatar表示头像地址，nickname表示昵称，c_time表示创建时间 |

返回码说明

| 返回码 | 说明         |
| ------ | ------------ |
| 0      | 成功         |
| -1     | 参数不能为空 |
| -2     | 错误的openid |

---

# 获取积分记录

接口用途

> 用来获取用户积分收支记录。包括分页操作。

接口地址

> /api/query_point_record/

访问方式

> HTTP  GET

参数字段

| 参数字段 | 说明                 |
| -------- | -------------------- |
| openid   | 微信唯一标识         |
| index    | 页码，非必选，默认0  |
| num      | 数量，非必选，默认10 |

返回字段

| 返回字段 | 说明                                                         |
| -------- | ------------------------------------------------------------ |
| code     | 返回码                                                       |
| msg      | 返回信息                                                     |
| data     | 返回数据，数据格式列表，列表每个元素是字典，字典key说明：name表示任务名称，c_time表示操作时间，point表示获取点数 |

返回码说明

| 返回码 | 说明         |
| ------ | ------------ |
| 0      | 成功         |
| -1     | 参数不能为空 |
| -2     | 错误的openid |

------

# 微信运动授权

接口用途

> 用来对微信运动授权，并获取用户最近30天的微信运动步数，在成功以后，会增加授权任务积分。

接口地址

> /api/wx_run/

访问方式

> HTTP   POST

参数字段

| 参数字段      | 说明         |
| ------------- | ------------ |
| openid        | 微信唯一标识 |
| encryptedData | 加密数据     |
| iv            | 加密向量     |

返回字段

| 返回字段 | 说明     |
| -------- | -------- |
| code     | 返回码   |
| msg      | 返回信息 |

返回码详情

| 返回码 | 说明              |
| ------ | ----------------- |
| 0      | 成功              |
| -1     | 参数字段不能为空  |
| -2     | 微信配置为空      |
| -3     | 错误的session key |
| -4     | 错误的openid      |
| -5     | 解析失败          |

---

# 查询认证状态

接口用途

> 用来查询用户各项认证状态，包括：手机认证、实名认证、授权等等。

接口地址

> /api/auth_status/

访问方式

> HTTP  GET

参数字段

| 参数字段 | 说明         |
| -------- | ------------ |
| openid   | 微信唯一标识 |

返回字段

| 返回字段 | 说明                                                         |
| -------- | ------------------------------------------------------------ |
| code     | 返回码                                                       |
| msg      | 返回信息                                                     |
| data     | 返回数据，数据格式字典，key说明：详见key说明。True表示已经完成，False表示没有完成。 |

key说明

| key值        | 说明                                                         |
| ------------ | ------------------------------------------------------------ |
| is_phone     | 是否手机认证                                                 |
| is_email     | 是否邮箱认证                                                 |
| is_real_name | 是否实名认证                                                 |
| is_face      | 是否人脸识别                                                 |
| is_wx_run    | 是否授权微信运动                                             |
| is_mp        | 表示公众号是否关联                                           |
| is_eye       | 是否完成眼底片任务上传                                       |
| eye_status   | 眼底任务状态，success表示已经完成，audit表示审核中，failed表示审核失败，need表示还没有提交审核。**注意：当状态为已完成或审核中，不允许再次提交审核。** |

返回码详情

| 返回码 | 说明         |
| ------ | ------------ |
| 0      | 成功         |
| -1     | 参数不能为空 |
| -2     | 错误的openid |

---

# 手机认证

接口用途

> 使用微信wx.getPhoneNumber获取手机号码，并增加积分。

接口地址

> /api/wx_phone/

访问方式

> HTTP  POST

参数字段

| 参数字段       | 说明         |
| -------------- | ------------ |
| openid         | 微信唯一标识 |
| encrypted_data | 加密数据     |
| iv             | 加密向量     |

返回字段

| 返回字段 | 说明     |
| -------- | -------- |
| code     | 返回码   |
| msg      | 返回信息 |

返回码说明

| 返回码 | 说明                 |
| ------ | -------------------- |
| 0      | 成功                 |
| -1     | 参数不能为空         |
| -2     | 微信配置不存在       |
| -3     | 仅能认证一次         |
| -4     | 错误的session key    |
| -5     | 错误的openid         |
| -6     | 微信用户没有手机号码 |
| -7     | 解析数据失败         |

---

# 查询签到状态

接口用途

> 用来查询用户当日是否已经签到。

访问地址

> /api/sign_status/

访问方式

> HTTP  GET

参数字段

| 参数字段 | 说明         |
| -------- | ------------ |
| openid   | 用户唯一标识 |

返回字段

| 返回字段 | 说明                                                         |
| -------- | ------------------------------------------------------------ |
| code     | 返回码                                                       |
| msg      | 返回信息                                                     |
| data     | 返回数据，数据格式字典，key说明：is_sign表示是否已经签到。True表示已经签到，Fasle反之 |

返回码详情

| 返回码 | 说明         |
| ------ | ------------ |
| 0      | 成功         |
| -1     | 参数不能为空 |
| -2     | 错误的openid |

---

# 上传文件

接口用途

> 用来上传文件，目前支持上传照片类文件。

访问方式

> HTTP   POST

接口地址

> /api/upload/

参数字段

| 字段名称 | 说明                                                         |
| -------- | ------------------------------------------------------------ |
| openid   | 用户微信唯一标识                                             |
| image    | 小程序文档中，文件对应的key，[文档](https://mp.weixin.qq.com/debug/wxadoc/dev/api/network-file.html#wxuploadfileobject) |

返回字段

| 字段名称 | 说明                                          |
| -------- | --------------------------------------------- |
| code     | 返回码                                        |
| msg      | 返回信息                                      |
| data     | 返回数据，数据类型字典，key说明：id表示文件id |

返回码说明

| 返回码 | 说明         |
| ------ | ------------ |
| 0      | 成功         |
| -1     | 参数不能为空 |
| -2     | 错误的openid |
| -3     | 上传文件失败 |

---

# 眼底片提交审核

接口用途

> 用来提交眼底片审核。

访问方式

> HTTP  POST

接口地址

> /api/apply_audit/

参数字段

| 字段名称 | 说明                                                    |
| -------- | ------------------------------------------------------- |
| openid   | 用户微信唯一标识                                        |
| files    | 上传文件的列表，需要格式化成JSON，如：'[1, 2, 3, 4, 5]' |

返回字段

| 返回字段 | 说明     |
| -------- | -------- |
| code     | 返回码   |
| msg      | 返回信息 |

返回码说明

| 返回码 | 说明                                         |
| ------ | -------------------------------------------- |
| 0      | 成功                                         |
| -1     | 参数不能为空                                 |
| -2     | 参数不正确                                   |
| -3     | 不能继续提交，用户已有在审核或审核通过的任务 |
| -4     | 上传文件列表不能为空                         |
| -5     | 操作失败                                     |

---

# 积分排行榜

接口用途

> 用来获取积分最多的10位用户信息。

接口地址

> /api/rank_by_balance/

参数字段

| 参数字段 | 说明           |
| -------- | -------------- |
| openid   | 微信用户openid |

返回字段

| 返回字段 | 说明                                                         |
| -------- | ------------------------------------------------------------ |
| code     | 返回码                                                       |
| msg      | 返回信息                                                     |
| data     | 返回数据，数据格式列表，如：[[排名, 昵称, 头像, 积分],[排名, 昵称, 头像, 积分] ] |
| rank     | 积分排行                                                     |

返回码说明

| 返回码 | 说明 |
| ------ | ---- |
| 0      | 成功 |

---

